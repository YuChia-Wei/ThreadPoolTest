### **K6 效能測試報告：執行時期預設執行緒集區 (Raw Streaming)**

**測試完成時間:** 2025-07-04T12:01:21Z (UTC)

#### **測試情境**

本次測試旨在評估 Raw Streaming 檔案上傳 API (`/upload/raw-streaming`) 在高負載下的效能表現。應用程式使用 .NET 執行時期的預設執行緒集區設定。

- **並發使用者數 (VUs):** 200
- **持續時間:** 5 分鐘
- **目標 RPS (每秒請求數):** 50

---

#### **核心效能指標**

| 指標 | 結果 |
| :--- | :--- |
| **總請求數** | 6,145 |
| **每秒請求數** | 19.73 |
| **成功率** | 99.87% |
| **失敗率** | 0.13% (8 個請求失敗) |
| **總傳輸資料量** | 32 GB |

---

#### **請求延遲分析**

- **平均值 (avg):** 9.86s
- **中位數 (med):** 7.72s
- **P90 (90百分位數):** 20.98s
- **P95 (95百分位數):** **26.36s**
- **最大值 (max):** 1分 1秒

---

#### **分析與結論**

1.  **效能瓶頸顯著:** 與預設執行緒集區的測試相似，本次測試的效能門檻「`p(95) < 3000ms`」**完全沒有通過**。P95 延遲時間為 **26.36 秒**，再次證明在高負載下，服務的回應能力有嚴重問題。

2.  **執行緒集區設定非關鍵因素:** 與預先設定執行緒集區的測試結果相比，本測試的各項數據（特別是 P95 延遲）非常接近。這強烈暗示，不論是預設還是手動增加執行緒，都對目前的效能瓶頸沒有實質影響。

3.  **問題根源在於應用程式邏輯:** 持續的高延遲和可觀的資料吞吐量，共同指向一個結論：問題的根源不在於執行緒的數量，而在於每個請求的處理方式。應用程式在處理串流資料時，很可能有效能不彰的 I/O 操作或同步鎖定等問題。

**結論:** 使用 .NET 執行時期的預設執行緒集區設定，同樣無法滿足 Raw Streaming API 在高併發下的效能需求。問題的核心與執行緒管理較無關聯，而更可能隱藏在檔案儲存的實作細節中。建議立即針對 `FileService` 的 `UploadFileStreamAsync` 方法進行程式碼審查和效能分析，找出並優化其中的 I/O 瓶頸。
